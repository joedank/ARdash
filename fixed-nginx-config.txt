# This is a fixed configuration file for your Nginx Proxy Manager
# For proxy host #15 (job.806040.xyz)

# Proxy for domain: job.806040.xyz
server {
  listen 80;
  listen [::]:80;
  
  # Domain names this server should respond to
  server_name job.806040.xyz;
  
  # Access and error logs
  access_log /data/logs/proxy-host-15_access.log proxy;
  error_log /data/logs/proxy-host-15_error.log warn;
  
  # Block common exploits
  include conf.d/include/block-exploits.conf;
  
  # Root location
  location / {
    # Pass requests to backend
    proxy_pass http://192.168.0.190:5173;
    
    # WebSocket support (only include these ONCE)
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
    
    # Other settings
    proxy_set_header Proxy "";
    proxy_buffering off;
  }
  
  # WebSocket specific path
  location /ws {
    proxy_pass http://192.168.0.190:5173;
    
    # No duplicate directives here - they're inherited from the parent location block
    # Just add any ws-specific configuration if needed
  }
  
  # Include SSL settings if needed
  include conf.d/include/ssl-settings.conf;
}

# Same server but for HTTPS
server {
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  
  # Domain names this server should respond to
  server_name job.806040.xyz;
  
  # SSL settings
  include conf.d/include/ssl-settings.conf;
  ssl_certificate /etc/letsencrypt/live/npm-24/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/npm-24/privkey.pem;
  
  # Access and error logs
  access_log /data/logs/proxy-host-15_access.log proxy;
  error_log /data/logs/proxy-host-15_error.log warn;
  
  # Block common exploits
  include conf.d/include/block-exploits.conf;
  
  # Root location
  location / {
    # Pass requests to backend
    proxy_pass http://192.168.0.190:5173;
    
    # WebSocket support (only include these ONCE)
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
    
    # Other settings
    proxy_set_header Proxy "";
    proxy_buffering off;
  }
  
  # WebSocket specific path
  location /ws {
    proxy_pass http://192.168.0.190:5173;
    
    # No duplicate directives here - they're inherited from the parent location block
    # Just add any ws-specific configuration if needed
  }
}